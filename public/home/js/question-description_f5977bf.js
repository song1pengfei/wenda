define("new:widget/question-description/question-description.js",function(t,e,i){{var n=t("common:widget/js/util/tangram/tangram.js"),s=t("common:widget/js/util/event/event.js"),a=t("common:widget/js/util/store/store.js"),o=t("common:widget/js/util/uri/uri.js"),l=t("common:widget/js/ui/dialog/dialog.js");t("common:widget/js/ui/tip/tip.js")}t("common:widget/lib/jquery.ui/jquery.ui.textarea_autosize.js");var c,d=n,r=(t("new:widget/js/input/input.js"),t("new:widget/js/ac/ac.js")),u=t("new:widget/js/authcode/authcode.js"),m=t("new:widget/js/lbs/lbs.js"),f=t("new:widget/js/webuploader/webuploader.js"),g=t("new:widget/js/phone/phone.js"),h=t("new:widget/js/editor/editor.js"),p=t("common:widget/lib/juicer/juicer.js"),v=t("new:widget/js/log/log.js"),b=t("new:widget/js/string/string.js"),w=(t("common:widget/js/logic/login/login.js"),t("common:widget/js/util/https/https.js")),k=n("#title-area"),j=n("#content-area"),x=n("#content-error-tip"),y=n(".qd-content-suggestion"),C={init:function(){var t=this;t.errorTip=n("#title-error-tip"),k.on("focus",function(){n(this).closest(".qd-content").addClass("focus"),u.init(),b.getLength(k)<10?d("#submit-btn").addClass("disabled"):(t.errorTip.html("").hide(),d("#submit-btn").removeClass("disabled")),t.suggestion(k)}).on("blur",function(){n(this).closest(".qd-content").removeClass("focus"),s.fire("input.sub",{}),r.ready(),setTimeout(function(){y.slideUp(200)},500)}).on("keyup.com",function(){s.fire("input.sub",{})}).on("keyup.cust",function(){var t=n.string(k.val()).trim();t&&(a.set("ik_new_asktitle",t),a.set("ik_new_asktitle_settime",+new Date))}).on("keydown",function(){r.cancel()}).on("keyup",function(){""===n.string(k.val()).trim()&&r.specialDisplay(),b.getLength(k)<10?d("#submit-btn").addClass("disabled"):d("#submit-btn").removeClass("disabled"),t.suggestion(k)}).on("compositionend",function(){t.suggestion(k)}).on("click",function(){s.fire("input.sub",{}),r.ready()}).on("input propertychange",function(){b.getLength(k)>=10&&t.errorTip.html("").hide()}),this.focusEnd(),d("#title-area").textareaAutoSize(),d("#content-area").textareaAutoSize(),j.on("keyup",function(){var t=d.trim(d(this).val());a.set("ik_new_askdetail",t),a.set("ik_new_askdetail_settime",+new Date)}).on("focus",function(){n(this).closest(".qd-content").addClass("focus")}).on("blur",function(){n(this).closest(".qd-content").removeClass("focus")}),setTimeout(function(){d("#title-area").trigger("keyup.com")},100),y.on("mouseenter","li",function(){y.find(".sug-content").hide(),d(this).find(".sug-content").show()}),y.on("click","li",function(){v.send({module:"ask-sample",page:"ask",area:"qd-content-sug",type:1025,action:"click"})}),this.bind(),this.addImgUploader(),this.wealthControl(),this.setPhone(),this.log()},sub:function(t,e){var i=d.string.getByteLength,n=d.string.subByte;return t=(t||"").replace(/<[^>]*>/g,""),e="number"!=d.type(e)?9999999:e,i(t)>e?n(t,e-2)+"...":t},suggestion:function(t){var e=d.trim(t.val());if(c&&clearTimeout(c),!e)return void y.slideUp("slow");var i=this;c=setTimeout(function(){d.ajax({url:"/api/newaskpush",data:{word:e},success:function(t){var e="object"==typeof t?t:d.json.parse(t);if(0!=e.errno)return void y.slideUp(200);if(i.searchSuggestionTpl||(i.searchSuggestionTpl=p(d("#sug-list-tpl").html())),e.list.length){d.each(e.list,function(t,e){e.answer=d.trim(i.sub(e.answer,200))});var n=i.searchSuggestionTpl.render(e);y.html(n).slideDown(200)}}})},500)},focusEnd:function(){var t=k.get(0);t.focus();var e=t.value.length;if(document.selection){var i=t.createTextRange();i.moveStart("character",e),i.collapse(),i.select()}else"number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd&&(t.selectionStart=t.selectionEnd=e)},bind:function(){var t=this;d("#qd-plus-btn").on("click",".supply-qd-btn",function(){var t=d(this).toggleClass("on-sup-show").hasClass("on-sup-show"),e=t?"收起补充":"补充问题";d(this).find(".txt").text(e),d(".question-description").find(".qd-desc")[t?"slideDown":"slideUp"]()}),d("#qd-img-list").on("click","li .del-btn",function(){var t=d(this).parent("li").index();d(this).parent().animate({width:0,height:0,"margin-right":0},"100",function(){h.setImgList("remove",{index:t}),d(this).remove(),0===d(this).closest("#qd-img-list li").length})}),d("#add-img-btn").on("click",function(){t.imgCnt=0,v.send({module:"ask-sample",page:"ask",area:"add-pic",type:80425,action:"click"})}),n("#doctor-btn").click(function(){b.getLength(k)>=10&&t.errorTip.html("").hide(),v.send({module:"ask-sample",page:"ask",area:"doctor-submit",type:80425,action:"click"});var e={cm:100001,fr:"dc",activity_id:0,consult_tag:0,special_time:0,from_id:1562};e.sms=d(".cb-status-on[data-id=phone]").length;var i=h.filterTag(h.getContent()),a=/<img[^>]*src="(.+?)"[^>]*>/gi,o=i.match(a);e.desc_pics="";for(var c=0;null!=o&&c<o.length;c++)o[c]=o[c].replace(a,"$1"),e.desc_pics+=o[c]+",";e.description=n.trim(n("#title-area").val())+i.replace(/<[^>].*?>/g,""),n("#doctor-btn").attr("disabled",!0),s.fire("editor.default");var r=new l({width:360,title:"编辑标签",content:p(d("#doctor-info-tpl").html()).render(),className:"doctor-dialog-box",autoDispose:!0,open:function(){n(".doctor-sex-label").click(function(){n(".doctor-sex-label").removeClass("active"),n(this).addClass("active")}),n(".doctor-dialog-box").on("click",".push-doctor-cancel, .i-close-ico",function(){n("#doctor-btn").attr("disabled",!1),r.close()}).on("click",".push-doctor-submit",function(){return e.sex=d(".doctor-sex").filter(":checked").val()||"",""===e.sex?void l.alert("您还没有选择性别"):""==n.trim(n("#doctor-age").val())||isNaN(n("#doctor-age").val())||n("#doctor-age").val()>120?void l.alert("您还没有填写年龄，范围0-120岁"):(e.age=n.trim(n("#doctor-age").val()),void s.fire("login.check",{isLogin:function(){"1"===F.context("user").isRealName?s.fire("login.realName",{onSubmitSuccess:function(){t.doctorSubmit(e)}}):t.doctorSubmit(e)}}))})}})}),d("#switch-submit-btn").on("click",function(){d('[data-hide="doctor"]').not(".invite-mavin").slideDown(),d('[data-show="doctor"]').hide(),d("#submit-btn").attr("data-force","1"),v.send({module:"ask-sample",page:"ask",type:80425,area:"switch-submit-btn",action:"click"})}),s.on("mavin.getList",function(e,i){i="object"==typeof i?i:{};var n=i.title||h.getTitle(),s=i.tagList||h.getTagList();if(!n||!s||!s.length)return void d(".invite-mavin").slideUp();var a=h.getContent();d.ajax({url:"/mavin/api/getrecmavin",dataType:"json",data:{title:n,tags:s.join(),content:a},success:function(e){if(!e.errno){var i=e.data;if(i&&i.list&&i.listNum){var n=i.list,s=h.getSelectedMavin(),a=[];d.each(n,function(t,e){-1===s.indexOf(e.uname)&&a.push(e)});var o=p(d("#mavin-list-selector-tpl").html(),{mavinList:a}),l=d(".invite-mavin");l.find(".mavin-list-selector").find("li").not(".on-select").remove(),l.find(".mavin-list-selector").append(o).find("li:gt(3)").hide(),l.find(".mavin-list-selector").find("li:lt(4)").show();var c=l.find(".mavin-list-selector").find("li").filter(".on-select").length,r=t.getRestWealth(),u=30,m=4;if(r>=u&&!c){var f=m;u*m>r&&(f=Math.floor(r/u)),l.find(".mavin-list-selector").find("li:lt("+f+")").addClass("on-select")}c=l.find(".mavin-list-selector").find("li").filter(".on-select").length,l.find("li:lt(4)").each(function(t,e){d(e)[t%2?"removeClass":"addClass"]("even-item")}),F.context("doctor-show")?d(".select-count").find(".select-mavin-cnt").text(c):l.slideDown("fast",function(){d(".select-count").find(".select-mavin-cnt").text(c)})}}}})})},addImgUploader:function(){var t=this,e=f.create({swf:"/static/swf/webuploader.swf",auto:!0,server:"/submit/ajax/",pick:{multiple:!1,id:"#add-img-btn"},resize:!1,formData:{cm:"100672"},duplicate:!0,fileVal:"image",accept:{title:"Images",extensions:"gif,jpg,jpeg,png",mimeTypes:"image/*"}});e.on("beforeFileQueued",function(e){if(!F.context("user").stoken)return s.fire("login.check",{noLogin:function(){s.fire("login.log",{onLoginSuccess:function(t){t.mobile&&(F.context("user").securemobil=t.mobile),F.context("user").stoken=t.stoken,F.context("wealth",t.userWealth),F.context("isFetchWealth",t.isFetchWealth)}})}}),!1;if(t.imgCnt=t.imgCnt||h.getImgList().length,t.imgCnt>=8)return l.close(),x.html("啊哦，提问最多只能上传8张图片").show(),setTimeout(function(){x.hide()},2e3),!1;var i=e.size>5242880;return i?(x.html("啊哦，图片大小不能超过5M！").show(),setTimeout(function(){x.hide()},2e3)):t.imgCnt++,!i});var t=this;e.on("filesQueued",function(i){var n=65,s=65;d.each(i,function(i,a){return t.addImg({src:"",width:n,height:s,pid:a.id}),window.XMLHttpRequest?void e.makeThumb(a,function(t,e){t?d("#"+a.id).append('<span class="preview-disable">不能预览</span>'):d("#"+a.id).append('<span class="img-mask">0%</span>').css("background-image","url("+e+")")},n,s):void d("#"+a.id).append('<span class="img-mask">0%</span>')})}),e.on("uploadProgress",function(t,e){d("#"+t.id).find(".img-mask").text((isFinite(e)?parseInt(100*e):100)+"%")});var t=this;e.on("uploadSuccess",function(t,e){var i=d("#"+t.id);+e.errorNo?i.find("span.img-mask").text("上传失败"):(h.setImgList("add",{url:e.url}),!window.XMLHttpRequest&&i.css("background-image","url("+w.autoTrans(e.url)+")"),i.removeClass("default-tip").find("span.img-mask").fadeOut("fast",function(){d(this).remove()}))}),e.on("uploadError",function(t){var e=d("#"+t.id);e.find("span.img-mask").text("上传失败")})},addImg:function(t){var e='<li id="'+t.pid+'"><span class="bg"></span><span class="del-btn">删 除</span></li>';d("#qd-img-list").fadeIn().append(e)},showLbs:function(){var t=n("<li />"),e=['<i class="ico i-insert-place"></i><span class="insert-place-label" id="address-label">地点</span>','<span class="address-info" id="address-info" style="display:none;">','关于<span class="address-value f-blue" id="address-value" data-flag="0"></span>的问题','<a class="del-place" id="address-delete">删除</a>',"</span>"].join("");t.addClass("add-local insert-place").appendTo("#qd-plus-btn .qd-plus-stuff").html(e).click(function(){function t(){var t=m.finalAddress,e=m.finalCity,i=m.finalLng,s=m.finalLat,a=m.flag,c="?address="+encodeURI(t)+"&city="+encodeURI(e)+"&lng="+i+"&lat="+s+"&flag="+a;new l.iframe({title:"",content:o.addmapAddress+c,width:n.ie?762:742,height:n.ie?520:500,draggable:!1})}var e=m.finalLng,i=m.finalLat;""==e&&""==i||0==e&&0==i?s.fire("lbs.send",{callback:function(){t()}}):t()})},setPhone:function(){if(F.context("user").isLogin){var t=F.context("user");t.securemobil&&(g.isBind=1)}n("#phone-bar").on("click","a",function(){s.fire("phone.bind",{onSubmitSuccess:function(){setTimeout(function(){window.location.reload()},500)}})})},wealthControl:function(){var t=this;d("#question-description").on("click",".cb-ico",function(){if(!d(this).hasClass("cb-status-dis")){var e=d(this);return v.send({module:"ask-sample",page:"ask",area:"cb-btn-"+d(this).data("id"),check:+!d(this).hasClass("cb-status-on"),type:80425,action:"click"}),d(this).hasClass("cb-status-on")?(d(this).removeClass("cb-status-on"),d(this).closest("li").find(".simulate-select").removeClass("simulate-select-on"),d(this).closest("li").find(".remind-wealth").removeClass("remind-wealth-on"),void("mavin"===e.data("id")&&d(".mavin-list-wrap").slideUp("fast",function(){d(this).find(".on-select").removeClass("on-select")}))):void s.fire("login.check",{isLogin:function(){var i=e.data("id"),n=t.getRestWealth(i),s=+d(".simulate-select").find(".reward-num").text()||0,a=30,o=d(".mavin-list-wrap").find("li.on-select").length||1,l=a*o,c={phone:20,mavin:l,reward:s,anonymity:0},r=c[i]||0;if("anonymity"==i)e.addClass("cb-status-on");else{if(n>=r)return e.addClass("cb-status-on"),e.closest("li").find(".simulate-select").addClass("simulate-select-on"),e.closest("li").find(".remind-wealth").addClass("remind-wealth-on"),void("mavin"===e.data("id")&&d(".mavin-list-wrap").slideDown("fast",function(){var t=d(this).find("li:visible:lt(4)").addClass("on-select").length;d(this).find(".select-mavin-cnt").text(t)}));t.lackWealthAlert()}},noLogin:function(){s.fire("login.log",{onLoginSuccess:function(t){t.mobile&&(F.context("user").securemobil=t.mobile),F.context("user").stoken=t.stoken,F.context("wealth",t.userWealth),F.context("isFetchWealth",t.isFetchWealth)}})}})}}).on("click",".reward-select-list li",function(){var e=+d(".simulate-select").find(".reward-num").text()||+F.context("wealth")||0,i=d(this).text(),n=parseInt(d(".simulate-select-on").text()||0);return""===F.context("wealth")?void d(".cb-ico[data-id=reward]").trigger("click"):t.getRestWealth()<0||t.getRestWealth()+n<i?(d(".simulate-select").find(".reward-num").text(e),void t.lackWealthAlert()):(d(".cb-ico[data-id=reward]").addClass("cb-status-on"),d(".cb-ico[data-id=reward]").closest("li").find(".simulate-select").addClass("simulate-select-on"),void d(".simulate-select").find(".reward-num").text(i))}).on("click",".simulate-select",function(){d(".reward-select-list").slideDown("fast",function(){d(document.body).one("click",function(){d(".reward-select-list").filter(":visible").hide()})})})},lackWealthAlert:function(t){t=t||"你的财富值不够用了，平时多攒点呀～",l.alert(t)},getRestWealth:function(t){var e=F.context("wealth");if(!+e&&""===e)return 0;var i=d(".cb-ico[data-id=phone]").filter(".cb-status-on"),n=20;i.length&&"phone"!==t&&(e-=n);var s=d(".cb-ico[data-id=reward]").filter(".cb-status-on"),a=+d(".award-list").find(".reward-num").text()||0;s.length&&"reward"!==t&&(e-=a);var o=d(".cb-ico[data-id=mavin]").filter(".cb-status-on"),l=30;if(o.length&&"mavin"!==t){var c=d(".mavin-list-wrap").find("li.on-select").length;e-=l*c}return e},doctorSubmit:function(t){var e="//muzhi.baidu.com/doctor/openapi/zhidaoask?random="+Math.random();n.ajax({type:"POST",url:e,dataType:"jsonp",data:t,timeout:1e4,success:function(t){n("#doctor-btn").removeAttr("disabled"),v.send({type:80425,action:"submit-success",from_id:1562,source:"zhidao-change",qid:t.data.qid}),t&&0==t.errno?setTimeout(function(){location.href="http://muzhi.baidu.com/question/"+t.data.qid+".html"},500):l.alert("提问失败，请重试:(")},error:function(){n("#doctor-btn").removeAttr("disabled"),l.alert("网络出错，请重试:(")}})},log:function(){v.send({module:"ask-sample",page:"ask",area:"page-pv",type:80425,action:"click"})}};i.exports=C});