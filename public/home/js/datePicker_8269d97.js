define("common:widget/js/ui/datePicker/datePicker.js",function(e,t,a){function s(e){e=e||this.selectedDate,this.curYear=e.getFullYear(),this.curMonth=e.getMonth(),this.curDate=e.getDate()}function i(){var e={headerText:v.format(this.selectedDate,"yyyy\u5e74M\u6708"),bodyContent:n.call(this),footerText:v.format(this.today,"yyyy\u5e74M\u6708d\u65e5 ")};return g.render(e)}function n(){for(var e=new Date(this.curYear,this.curMonth,1,0,0,0,0),t=e.getDay()||7,a=42-t,s=[],i=-t;a>i;++i){var n=new Date(e.getTime()+24*i*3600*1e3);s.push({color:n.getDay()%6?"":" holiday",disabled:n.getMonth()!=e.getMonth()?" disabled":"",selected:n.getTime()==this.selectedDate.getTime()?" selected":"",now:n.getTime()==this.today.getTime()?" now":"",value:n.getDate()})}return w.render({dData:s})}function r(e){for(var t=[],a=0;12>a;++a)t.push({selected:(e?a==this.curMonth:this.curYear==this.selectedDate.getFullYear()&&a==this.selectedDate.getMonth())?" selected":"",now:this.curYear==this.today.getFullYear()&&a==this.today.getMonth()?" now":""});return D.render({mData:t})}function o(e){for(var t=this.curYear-this.curYear%10,a=[],s=-1;10>=s;++s)a.push({disabled:(s+1)%11?"":" disabled",selected:t+s==(e?this.curYear:this.selectedDate.getFullYear())?" selected":"",now:t+s==this.today.getFullYear()?" now":"",value:t+s});return b.render({yData:a})}function c(e,t){var a=this.bubblePanel.getNode(),s=m(".headerContent",a),i=m(".calendarBody .aniBox",a);s.attr("evt-data","type="+e),m(".leftBtn",a).attr("evt-data","type="+e+"&method=REDUCE"),m(".rightBtn",a).attr("evt-data","type="+e+"&method=INCREASE");var c,l=m(".new",i).removeClass("new").addClass("old"),d=l.outerWidth();switch(e){case"YEAR":s.removeAttr("evt-action").addClass("disabled").html(this.curYear-this.curYear%10+"-"+(this.curYear-this.curYear%10+9)),i.css("left","slideRight"==t?-d:0),c=m(o.call(this,"shrink"==t?!0:!1)),i[/slideLeft|expand/.test(t)?"append":"prepend"](c);break;case"MONTH":s.attr("evt-action","headerContent").removeClass("disabled").html(this.curYear+"\u5e74"),i.css("left","slideRight"==t?-d:0),c=m(r.call(this,"shrink"==t?!0:!1)),i[/slideLeft|expand/.test(t)?"append":"prepend"](c);break;case"DATE":s.attr("evt-action","headerContent").removeClass("disabled").html(this.curYear+"\u5e74"+(this.curMonth+1)+"\u6708"),i.css("left","slideRight"==t?-d:0),c=m(n.call(this)),i[/slideLeft|expand/.test(t)?"append":"prepend"](c)}switch(t){case"slideRight":i.animate({left:0},300,function(){l.remove()});break;case"slideLeft":i.animate({left:-d},300,function(){l.remove(),i.css("left",0)});break;case"shrink":case"expand":m(".pageBlock",i).css({position:"absolute",left:0,top:0});var h=m("shrink"==t?m(".big",c).not(".disabled")["MONTH"==e?this.curMonth:this.curYear%10]:m(".big",l).not(".disabled")["MONTH"==e?this.curYear%10:this.curMonth]),p=h.position(),v={width:h.outerWidth(),height:h.outerHeight()},f={width:l.outerWidth(),height:l.outerHeight()},y={x:f.width/v.width,y:f.height/v.height},g={x:p.left+v.width/2,y:p.top+v.height/2},b={translateX:g.x-f.width/2,translateY:g.y-f.height/2,innerScaleX:1-1/y.x,innerScaleY:1-1/y.y,outerScaleX:y.x-1,outerScaleY:y.y-1};"shrink"==t?(u.call(c,"transform-origin",g.x+"px "+g.y+"px"),u.call(c,"transform","scale("+y.x+","+y.y+")"),l.animate({opacity:0},{duration:300,step:function(e){u.call(c,"transform","scale("+(1+e*b.outerScaleX)+","+(1+e*b.outerScaleY)+")"),e=1-e,u.call(l,"transform","translate("+e*b.translateX+"px,"+e*b.translateY+"px)scale("+(1-e*b.innerScaleX)+","+(1-e*b.innerScaleY)+")")},complete:function(){l.remove(),c.removeAttr("style")}})):(u.call(l,"transform-origin",g.x+"px "+g.y+"px"),u.call(c,"transform","translate("+b.translateX+"px,"+b.translateY+"px)scale("+1/y.x+","+1/y.y+")"),c.css("opacity",0),c.animate({opacity:1},{duration:300,step:function(e){l.css("opacity",1-e),u.call(l,"transform","scale("+(1+e*b.outerScaleX)+","+(1+e*b.outerScaleY)+")"),e=1-e,u.call(c,"transform","translate("+e*b.translateX+"px,"+e*b.translateY+"px)scale("+(1-e*b.innerScaleX)+","+(1-e*b.innerScaleY)+")")},complete:function(){l.remove(),c.removeAttr("style")}}))}}function l(){this.hide(),h(this.onSelect,this.selectedDate),this.hostAutoFill&&this.host.val(v.format(this.selectedDate,this.datePattern))}function d(){var e=this.bubblePanel.getNode(),t=this;this.host.on("focus",function(){t.show()}),e.on("click.datePicker",'[evt-action="headerContent"]',function(){try{var e=m.url.queryToJson(m(this).attr("evt-data"));switch(e.type){case"MONTH":c.call(t,"YEAR","shrink");break;case"DATE":c.call(t,"MONTH","shrink")}}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"common:widget/js/ui/datePicker/datePicker.js",method:"",ln:355})}}),e.on("click.datePicker",'[evt-action="headerSwitch"]',function(){try{var e=m.url.queryToJson(m(this).attr("evt-data")),a=new Date(t.curYear,t.curMonth,1,0,0,0,0);switch(e.type){case"YEAR":a.setYear(a.getFullYear()+("REDUCE"==e.method?-10:10));break;case"MONTH":a.setYear(a.getFullYear()+("REDUCE"==e.method?-1:1));break;case"DATE":a.setMonth(a.getMonth()+("REDUCE"==e.method?-1:1))}s.call(t,a),c.call(t,e.type,"REDUCE"==e.method?"slideRight":"slideLeft")}catch(i){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message,path:"common:widget/js/ui/datePicker/datePicker.js",method:"",ln:376})}}),e.on("click.datePicker",'[evt-action="pickUp"]',function(e){try{var a=m.url.queryToJson(m(this).attr("evt-data"));switch(e.stopPropagation(),a.type){case"YEAR":t.curYear=parseInt(a.value),c.call(t,"MONTH","expand");break;case"MONTH":t.curMonth=parseInt(a.value),c.call(t,"DATE","expand");break;case"DATE":t.curDate=parseInt(a.value),t.selectedDate=new Date(t.curYear,t.curMonth,t.curDate,0,0,0,0),l.call(t);break;case"TODAY":t.selectedDate=new Date(t.today.setHours(0,0,0,0)),l.call(t)}}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"common:widget/js/ui/datePicker/datePicker.js",method:"",ln:403})}})}function h(e,t){e&&"function"==m.type(e)&&e.call(null,t)}function u(e,t){this.css("-webkit-"+e,t),this.css("-moz-"+e,t),this.css("-o-"+e,t),this.css("-ms-"+e,t),this.css(e,t)}function p(e){if(!e)throw new Error("[DatePicker Exception]: No arguments.");this.host=m(e.host),this.hostAutoFill="boolean"==m.type(e.hostAutoFill)?e.hostAutoFill:!0,this.datePattern=e.datePattern||"yyyy-MM-dd",this.today=v.build(e.today)||new Date,this.today.setHours(0,0,0,0),this.onSelect="function"==m.type(e.onSelect)?e.onSelect:null,this.bubblePanel=new f({host:this.host,pos:e.pos,zIndex:e.zIndex,marginFromHost:e.marginFromHost,offset:e.offset,hideWhenBlur:e.hideWhenBlur,blurProtect:e.blurProtect,animation:e.animation,onShow:e.onShow,onHide:e.onHide}),d.call(this)}var m=e("common:widget/lib/jquery/jquery.js"),v=e("common:widget/js/util/tangram/timeFormater.js"),f=e("common:widget/js/ui/bubblePanel/bubblePanel.js"),y=e("common:widget/lib/juicer/juicer.js"),g=y('<div class="calendarPanel"><div class="calendarHeader"><a href="javascript:;" class="leftBtn" evt-action="headerSwitch" evt-data="type=DATE&method=REDUCE"><em></em></a><a href="javascript:;" class="headerContent" evt-action="headerContent" evt-data="type=DATE">$${headerText}</a><a href="javascript:;" class="rightBtn" evt-action="headerSwitch" evt-data="type=DATE&method=INCREASE"><em></em></a></div><div class="calendarBody"><div class="aniBox">$${bodyContent}</div></div><div class="calendarFooter" evt-action="pickUp" evt-data="type=TODAY" title="\u9009\u62e9\u4eca\u65e5"><a href="javascript:;">\u4eca\u65e5\uff1a$${footerText}</a></div></div>'),b=y('<div class="pageBlock new">{@each yData as item}<a href="javascript:;" class="big$${item.disabled}$${item.selected}$${item.now}"{@if !item.disabled} evt-action="pickUp" evt-data="type=YEAR&value=$${item.value}"{@/if}>$${item.value}</a>{@/each}</div>'),D=y('<div class="pageBlock new">{@each mData as item, i}<a href="javascript:;" class="big$${item.selected}$${item.now}" evt-action="pickUp" evt-data="type=MONTH&value=$${i}">$${parseInt(i) + 1}\u6708</a>{@/each}</div>'),w=y('<div class="pageBlock new"><div class="week"><span class="holiday">\u65e5</span><span>\u4e00</span><span>\u4e8c</span><span>\u4e09</span><span>\u56db</span><span>\u4e94</span><span class="holiday">\u516d</span></div><div class="day">{@each dData as item}<a href="javascript:;" class="small$${item.color}$${item.disabled}$${item.selected}$${item.now}" evt-action="$${item.disabled ? "" : "pickUp"}" evt-data="type=DATE&value=$${item.value}">$${item.value}</a>{@/each}</div></div>');p.prototype={constructor:p,getDate:function(){return this.selectedDate||this.today||(new Date).setHours(0,0,0,0)},show:function(e){try{this.selectedDate=v.build(e||this.hostAutoFill&&this.host.val()||this.today||new Date)}catch(t){this.selectedDate=this.today||new Date}(isNaN(this.selectedDate)||"Invalid Date"==this.selectedDate.toString())&&(this.selectedDate=new Date),this.selectedDate.setHours(0,0,0,0),s.call(this),this.bubblePanel.setContent(i.call(this));var a=this;this.bubblePanel.show(function(){a.hostAutoFill&&a.host.val(v.format(a.selectedDate,a.datePattern))})},hide:function(){this.bubblePanel.hide()}},a.exports=p});