define("question:widget/js/set-tag/set-tag.js",function(t,e,a){var s,i=t("common:widget/js/util/tangram/tangram.js"),n=(t("common:widget/js/util/event/event.js"),t("common:widget/js/ui/base/base.js")),o=t("common:widget/js/util/template/template.js"),c=t("common:widget/js/ui/dialog/dialog.js"),l=t("common:widget/js/ui/scrollbar/scrollbar.js"),g=t("common:widget/js/util/tangram/string.js"),r=n(function(t){var e=this;e.options=i.extend({title:"\u6211\u7684\u5174\u8da3",width:"582px",height:"471px",type:"add",askTitle:"",dialogClassName:"",success:function(){},error:function(){}},t),e.delTags=[]}).extend({init:function(t){try{this.render(t)}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"question:widget/js/set-tag/set-tag.js",method:"",ln:42})}},render:function(t){var e=this,t=i.extend(e.options,t);e.instance=new c({title:t.title,dialogClass:t.dialogClassName||"dialog-set-tag",content:e.html(t.type),autoDispose:!0,width:t.width,height:t.height,open:function(){i(".dialog-set-tag").delegate(".tag-search-input","focus",function(){i(this).hasClass("error")&&i(this).val("").removeClass("error")}),i(document).bind("keydown",function(t){var t=t||window.event,e=t.keyCode||t.which||t.charCode;13==e&&i(".dialog-set-tag .search-btn").click()})},close:function(){s=!1,i(document).unbind("keydown")},buttons:[{text:s?"\u4fdd\u5b58":"\u5b8c\u6210",click:function(){try{"set"==t.type&&(i(e.delTags).each(function(){for(var t=e.tags.length-1;t>=0;t--)e.tags[t].name==this&&e.tags.splice(t,1)}),e.delTags.length=0),("set"==t.type||"add"==t.type)&&e.submit(s?function(){i(".wgt-ihome-filter .tag-setting").click()}:null)}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"question:widget/js/set-tag/set-tag.js",method:"",ln:94})}}},{text:s?"\u8fd4\u56de":"\u53d6\u6d88",click:function(){try{s&&(s=!1,i(".wgt-ihome-filter .tag-setting").click()),i(this).dialog("close")}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/js/set-tag/set-tag.js",method:"",ln:103})}}}]}),e.instance.setSize({width:parseInt(t.width),height:parseInt(t.height)});var a=e.container=e.instance.getDialogContainer();if("add"==t.type)a.on("click",".search-btn",function(){try{e.search(i(this).prev())}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/js/set-tag/set-tag.js",method:"",ln:116})}}),a.on("click",".tag-item",function(t){try{var e=i(this);e.hasClass("active")?e.removeClass("active"):e.addClass("active")}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/js/set-tag/set-tag.js",method:"",ln:125})}});else if("set"==t.type){a.on("click",".i-del",function(t){try{var a=i(this).parent();e.delTags.push(a.text()),a.remove(),t.stopPropagation()}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/js/set-tag/set-tag.js",method:"",ln:133})}}),a.on("click",".addtag-btn",function(){try{e.close(),s=!0,i(".carousel-inner .tag-item:last").click()}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/js/set-tag/set-tag.js",method:"",ln:138})}})}else("uadmin"===t.type||"qualitysort"===t.type||"question"===t.type)&&(a.delegate(".i-del","click",function(t){try{var a=i(this).parent();e.delTags.push(a.text()),a.remove(),t.stopPropagation()}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/js/set-tag/set-tag.js",method:"",ln:161})}}),a.find(".item-checked").delegate(".tag-item, .third-tags .tags","click",function(t){try{var e=i(this),a=i(".currentTag").find(".tag-item").length;if(a>=3)return i(this).hasClass("tags")?i(".more-labels").append(i(".red-tips")):i(this).parent().parent().prev().append(i(".red-tips")),i(".red-tips").show(),void setTimeout(function(){i(".red-tips").hide()},3e3);var s=!0;i(".currentTag .tag-item").each(function(t,a){i.trim(i(a).text())==i.trim(e.text())&&(s=!1)}),s&&i('<a class="tag-item"><i class="i-del"></i><span>'+e.text()+"</span></a>").insertAfter(".currentTag .currentTitle"),i(this).hasClass("tags")?e.parent().addClass("checked"):e.addClass("active")}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/js/set-tag/set-tag.js",method:"",ln:199})}}))},submit:function(t){var e=this,a=e._getTag();i.post("/submit/user",{cm:100522,tags:a.name.join("	")},function(s){if(s&&0==s.errorNo)F.context("user").tags=e.tags=a.obj,e.close(),e.options.success.call(e,a.obj),i.isFunction(t)&&t();else if(s&&18001==s.errorNo){var n="\u5bf9\u4e0d\u8d77\uff0c\u60a8\u6dfb\u52a0\u7684tag\u8fc7\u591a\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9";i("#tag-search-input").val(n).addClass("error")}else{var n="\u62b1\u6b49\uff0c\u672a\u80fd\u627e\u5230\u60a8\u60f3\u6dfb\u52a0\u7684\u5174\u8da3\u6807\u7b7e\uff0c\u8bf7\u91cd\u65b0\u5c1d\u8bd5";i("#tag-search-input").val(n).addClass("error")}},"json")},html:function(t){var e=[];return"add"==t?e.push('<div class="line mb-15">','<input name="tag-search" type="text" value="" placeholder="\u5728\u6b64\u8f93\u5165\u5174\u8da3\u5173\u952e\u5b57" class="tag-search-input" id="tag-search-input" />','<a class="btn-32-green search-btn ml-10">\u641c\u7d22\u5174\u8da3</a>',"</div>",'<h1 class="mt-10 mb-15">\u70ed\u95e8\u6807\u7b7e</h1>','<div class="dialog-tags-wp mt-15">','<div class="dialog-tags line">','<#if( "object" == typeof hot ){#>',"<#for(var i = 0;i < hot.length;i++){#>",'<a class="tag-item" data-type="<#=hot[i].legal#>">',"<span><#:=hot[i].name#></span>","</a>","<#}#>","<#}#>","</div>","</div>"):"uadmin"==t||"qualitysort"==t?(e.push('<div class="tags-wrap line">','<div class="currentTag dialog-tags line">','<h1 class="currentTitle">\u5f53\u524d\u6807\u7b7e\uff1a</h1>','<#if( "object" == typeof tags.current ){#>',"<#for(var i = 0;i < tags.current.length;i++){#>",'<a class="tag-item" data-type="<#=tags.current[i].legal#>">','<i class="i-del"></i>',"<span><#:=tags.current[i].name#></span>","</a>","<#}#>","<#}#>","</div>",'<p class="red-tips ff-arial">\u95ee\u9898\u6807\u7b7e\u4e0d\u80fd\u8d85\u8fc7\u4e09\u4e2a</p>','<div class="recommend-tag">','<#if( "object" == typeof tags.recommend && tags.recommend.length > 0){#>','<h1 class="">\u63a8\u8350\u6807\u7b7e\uff1a</h1>','<div class="dialog-tags-wp mt-15 item-checked">','<div class="dialog-tags line">',"<#for(var i = 0;i < tags.recommend.length;i++){#>",'<a class="tag-item" data-type="<#=tags.recommend[i]#>">',"<span><#:=tags.recommend[i].tagname#></span>","</a>","<#}#>","</div>","</div>","<#}#>","</div>","</div>",'<h1 class="more-labels">\u66f4\u591a\u6807\u7b7e\uff1a</h1>','<div class="line more-tags">','<div class="tag-input line">','<input type="text" placeholder="\u5728\u6b64\u8f93\u5165\u5174\u8da3\u5173\u952e\u8bcd" class="tag-input-ser" />','<i class="iknow-qb_home_icons"></i>',"</div>","</div>",'<div class="dialog-tags-wp item-checked">','<i class="ope-arrow-down"><em></em></i>','<div class="dialog-tags line more-tags-container">',"</div>","</div>",'<div class="dialog-tags-wp mt-15 ui-dialog-buttonset clearfix">'),"uadmin"==t?e.push('<a href="javascript:void(0)" class="btn-32-green save">\u4fdd\u5b58</a>','<a href="javascript:void(0)" class="btn-32-white cancel">\u53d6\u6d88</a>'):e.push('<a href="javascript:void(0)" class="btn-32-white qsort-bad grid">\u63d0\u95ee\u4e0d\u591f\u597d</a>','<a href="javascript:void(0)" class="btn-32-green qsort-normal grid-r">\u4e00\u822c\u63d0\u95ee</a>','<a href="javascript:void(0)" class="btn-32-green qsort-good grid-r">\u4e13\u4e1a\u63d0\u95ee</a>'),e.push("</div>")):"question"===t?(e.push('<div class="tags-wrap line">','<div class="currentTag dialog-tags line">','<h1 class="currentTitle">\u5f53\u524d\u6807\u7b7e\uff1a</h1>','<#if( "object" == typeof tags.current ){#>',"<#for(var i = 0;i < tags.current.length;i++){#>",'<a class="tag-item" data-type="<#=tags.current[i].legal#>">','<i class="i-del"></i>',"<span><#:=tags.current[i].name#></span>","</a>","<#}#>","<#}#>","</div>",'<p class="red-tips ff-arial">\u95ee\u9898\u6807\u7b7e\u4e0d\u80fd\u8d85\u8fc7\u4e09\u4e2a</p>',"</div>",'<h1 class="more-labels">\u66f4\u591a\u6807\u7b7e\uff1a</h1>','<div class="line more-tags">','<div class="tag-input line">','<input type="text" placeholder="\u5728\u6b64\u8f93\u5165\u5174\u8da3\u5173\u952e\u8bcd" class="tag-input-ser" />','<i class="iknow-qb_home_icons"></i>',"</div>","</div>",'<div class="dialog-tags-wp item-checked">','<i class="ope-arrow-down"><em></em></i>','<div class="dialog-tags line more-tags-container">',"</div>","</div>",'<div class="dialog-tags-wp mt-15 ui-dialog-buttonset clearfix">'),e.push('<a href="javascript:void(0)" class="btn-32-green saveTo">\u4fdd\u5b58</a>','<a href="javascript:void(0)" class="btn-32-white cancel">\u53d6\u6d88</a>'),e.push("</div>")):(i(this.options.tags).each(function(){this.dbLine=i.string(this.name).getByteLength()>8?"tag-db-line":""}),e.push('<p class="dialog-intro line">','<a class="addtag-btn grid"><i></i><span>\u6dfb\u52a0\u5174\u8da3</span></a>','<span class="grid-r mr-40">','<i class="i-tip"></i>',"\u76f4\u63a5\u62d6\u52a8\u53ef\u6539\u53d8\u6807\u7b7e\u987a\u5e8f\u54e6~","</span>","</p>",'<div class="dialog-tags-wp mt-15">','<div class="dialog-tags line">','<#if( "object" == typeof tags ){#>',"<#for(var i = 0;i < tags.length;i++){#>",'<a class="tag-item <#=tags[i].dbLine#>" data-type="<#=tags[i].legal#>">','<i class="i-del"></i>',"<span><#:=tags[i].name#></span>","</a>","<#}#>","<#}#>","</div>","</div>")),o(e.join(""),this.options)},show:function(){this.instance.show()},close:function(){this.instance.close()},search:function(t){var e=this;i(t).hasClass("error")||(""==i(t).val()&&i(t).addClass("error"),i.post("/api/gettag",{type:1,wd:t.val()},function(a){if(a&&0==a.errno){i("h1",e.container).empty();var s=i(".dialog-tags",e.container).empty(),n=t.val();i(a.data).each(function(){e.addTag({name:this.tagname,legal:1},s),n.toLocaleUpperCase()==this.tagname.toLocaleUpperCase()&&(n="")}),n&&e.addTag({name:n,legal:1},s),i(".dialog-tags-wp .scrollbar-wp").remove();var o=new l({scrollWrapper:i(".dialog-tags-wp"),scrollContent:i(".dialog-tags"),maxHeight:225});o.render()}},"json"))},getTags:function(){var t=[];return i(".tag-item.active",this.container).each(function(){t.push({name:i(this).text(),legal:i(this).data("type")})}),t},_getTag:function(){var t={name:[],type:[],obj:[]};if("set"==this.options.type)i(".tag-item",this.container).each(function(){t.name.push(i(this).text()),t.type.push(i(this).data("type")),t.obj.push({name:i(this).text(),legal:i(this).data("type")})});else{i(".carousel-inner .tag-item").each(function(){i(this).data("type")>=0&&(t.name.push(i(this).text()),t.type.push(i(this).data("type")),t.obj.push({name:i(this).text(),legal:i(this).data("type")}))});var e="|"+t.name.join("|")+"|";i(".tag-item.active",this.container).each(function(){var a=i(this).text();-1==e.indexOf("|"+a+"|")&&(t.name.push(a),t.type.push(i(this).data("type")),t.obj.push({name:i(this).text(),legal:i(this).data("type")}))})}return t},addTag:function(t,e){var a=t.name||t.tagname,s=i.string(a).getByteLength()>8;i("<a />").addClass("tag-item"+(s?" tag-db-line":"")).data("type",t.legal||0).html("<span>"+g.encodeHTML(a)+"</span>").appendTo(e)}});a.exports=r});