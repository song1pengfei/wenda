define("question:widget/ask/tag/tag.js",function(t,a,e){var s=t("common:widget/js/util/tangram/tangram.js"),n=t("common:widget/js/ui/base/base.js"),i=t("common:widget/js/ui/dialog/dialog.js"),o=t("question:widget/js/set-tag/set-tag.js"),g=t("common:widget/js/util/log/log.js"),c=n(function(){}).extend({init:function(){try{var t=this;t.bindEvent()}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"question:widget/ask/tag/tag.js",method:"",ln:18})}},_truncate:function(t,a,e){return t.length>a?t.substr(0,a)+e:t},bindEvent:function(){var t=this;s("#wgt-ask").on("click",".question-tag-change",function(a){try{a.preventDefault(),g.send({module:"question",page:"ask",action:"click",area:"question-tag-change"});var e=s(this),n=F.context("page"),c=n.title,r=(n.qid,{}),d="question";r.current=[];var l=e.prev().find(".question-tag-link");l.each(function(){r.current.push({name:s(this).text()})}),r.title=c;var p=new o({width:556,height:420,type:d,tags:r,dialogClassName:"question-dialog dialog-set-tag",title:"\u7f16\u8f91\u6807\u7b7e",success:function(){}});s(".question-dialog").on("keyup",".tag-input-ser",function(t){return t.preventDefault(),""===s(".tag-input input").val()?(s(".tag-input input").css("border-color","#f93535").focus(),s(".more-tags-container").empty().hide(),s(".dialog-tags-wp .ope-arrow-down").hide(),void s(".dialog-tags-wp .tag-input-ser").val("")):(s(".tag-input input").css("border-color","#4aca6d"),void s.ajax({type:"POST",url:"/api/gettag",async:!1,data:{type:1,wd:s(".tag-input input").val()},success:function(t){var a=[];if(t=s.json.parse(t),t.data.length>0){for(var e=t.data.length>5?5:t.data.length,n=0;e>n;n++)a.push('<a class="tag-item" data-type=""><span>'+t.data[n].tagname+"</span></a>");s(".more-tags-container").empty().append(a.join("")).show(),s(".dialog-tags-wp .ope-arrow-down").show()}else s(".more-tags-container").html('<div class="no-tags-tip">\u6ca1\u6709\u627e\u5230\u76f8\u5173\u6807\u7b7e</div>').show(),s(".dialog-tags-wp .ope-arrow-down").show()}}))}).on("blur",".tag-input-ser",function(){t.tagHideTimer=setTimeout(function(){s(".more-tags-container").empty().hide(),s(".dialog-tags-wp .ope-arrow-down").hide(),s(".dialog-tags-wp .tag-input-ser").val("")},1e3)}).on("click",".tag-item",function(){try{s(".more-tags-container").empty().hide(),s(".dialog-tags-wp .ope-arrow-down").hide(),s(".dialog-tags-wp .tag-input-ser").val("")}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/ask/tag/tag.js",method:"",ln:127})}}).on("click",".search-all",function(){try{if(""!==s(".more-tags-container").html())return void s(".more-tags-container").html("");s.ajax({type:"POST",url:"/api/gettagtree",async:!1,data:{},success:function(a){a="object"==typeof a?a:s.json.parse(a),s(".more-tags-container").empty().append('<div class="allTagTop"></div>'),s(".more-tags-container").append('<table class="tags-table"><tr><td class="first-tags"></td><td class="second-tags"></td><td class="third-tags"></td></tr></table>');for(var e=0;e<a.data.length;e++)s(".first-tags").append('<p class="first-tag-name first-tag'+e+'"><span class="tags">'+a.data[e].name+'</span><span class="next"></span></p>'),s(".first-tag"+e).val(a.data[e]);s(".ui-dialog-content").scrollTop(s(".tags-wrap").height()+10),s(".first-tags").on("click",".first-tag-name",function(){try{if(s(this).hasClass("checked"))return;s(".second-tags").empty(),s(".third-tags").empty(),s(".first-tag-name").removeClass("checked"),s(this).addClass("checked");for(var t=s(this).val().child,a=0;a<t.length;a++)s(".second-tags").append('<p class="second-tag-name second-tag'+a+'"><span class="tags">'+t[a].name+'</span><span class="next"></span></p>'),s(".second-tag"+a).val(t[a])}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"question:widget/ask/tag/tag.js",method:"",ln:165})}}),s(".second-tags").on("click",".second-tag-name",function(){try{if(s(this).hasClass("checked"))return;s(".third-tags").empty(),s(".second-tag-name").removeClass("checked"),s(this).addClass("checked");for(var a=s(this).val().tags,e=0;e<a.length;e++)s(".third-tags").append(e%2===0?'<p class="third-tag-name second-tag'+e+'" style="float: left"><span class="tags">'+t._truncate(a[e],5,"")+"</span></p>":'<p class="third-tag-name second-tag'+e+'" style="float: right"><span class="tags">'+t._truncate(a[e],5,"")+"</span></p>")}catch(n){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message,path:"question:widget/ask/tag/tag.js",method:"",ln:182})}}),s(".third-tags").on("click",".third-tag-name",function(){try{}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/ask/tag/tag.js",method:"",ln:199})}})}})}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"question:widget/ask/tag/tag.js",method:"",ln:202})}}).on("click",".cancel",function(){try{p.close()}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"question:widget/ask/tag/tag.js",method:"",ln:205})}}).on("click",".saveTo",function(){try{var t=[],a=[],n=F.context("page").qid;if(s(".currentTag .tag-item").each(function(e,n){var i=s.trim(s(n).text());t.push(i),a.push('<a href="/list?tag='+i+'" target="_blank" class="question-tag-link">'+i+"</a>")}),t=t.join("_"),a=a.join(""),""==t)return void s(".currentTag .tag-tips").html("\u8bf7\u81f3\u5c11\u7ed9\u95ee\u9898\u8bbe\u7f6e\u4e00\u4e2a\u6807\u7b7e").css("color","red");s.ajax({url:"/submit/ajax",type:"POST",dataType:"json",data:{cm:100155,qid:n,content_tag:t},success:function(t){p.close(),0==t.errorNo?e.parent().find(".question-list-item-tag").html(a):i.alert(t.data.info)},error:function(){p.close(),i.alert("\u4fee\u6539\u672a\u6210\u529f\uff0c\u8bf7\u91cd\u8bd5")}})}catch(o){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message,path:"question:widget/ask/tag/tag.js",method:"",ln:263})}}).on("keypress",".tag-input input",function(t){"13"===t.keyCode&&s(".search-interest").trigger("click")})}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"question:widget/ask/tag/tag.js",method:"",ln:268})}})}});e.exports=c});